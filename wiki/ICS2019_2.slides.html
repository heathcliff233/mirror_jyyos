<html>
  <Head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    
<link rel="stylesheet" href="../static/css/bootstrap.min.css"/>
<link rel="stylesheet" href="../static/css/bootstrap-theme.min.css"/>


    <link rel="stylesheet" href="../static/css/fonts/crmison.css"/>
    <link rel="stylesheet" href="../static/css/fonts/fira_code.css"/>
    <link rel="stylesheet" href="../static/css/fonts/ptsans.css"/>
    <link rel="stylesheet" href="../static/css/katex.min.css"/>
    <link rel="stylesheet" href="../static/css/wiki.css"/>
    <link rel="stylesheet" href="../static/css/codehilite.css"/>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/katex.min.js"></script>
    
<link rel="stylesheet" href="../static/css/wiki.css"/>
<link rel="stylesheet" href="../static/css/slides.css"/>


    <title>Hello, C World</title>
  </Head>
  <body>
   
   
<textarea id="source">
public: True
class: center, middle

# Hello, C World

è’‹ç‚å²© <jyy@nju.edu.cn>

<div class="row justify-content-md-center">
  <div class="center author-block">
    <p><a href="http://www.nju.edu.cn/">å—äº¬å¤§å­¦</a></p>
    <img class="inline-img" height="64px" src="../static/img/nju.png"/>
  </div>
  <div class="center author-block">
    <p><a href="http://cs.nju.edu.cn/">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</a></p>
    <img class="inline-img" height="64px" src="../static/img/njucs.jpg"/>
  </div>
  <div class="center author-block">
    <p><a href="http://moon.nju.edu.cn/">è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</a></p>
    <img class="inline-img" height="60px" src="../static/img/ics-nju.png"/>
  </div>
</div>

---

# æœ¬æ¬¡è¯¾å†…å®¹

* C è¯­è¨€æ‹¾é—
    * main å‡½æ•°
    * é¢„ç¼–è¯‘
    * ç¨‹åºçš„æ‰§è¡Œ
    * å˜é‡å’Œç±»å‹
    * è¯­å¥

---

class: center, middle

# Cè¯­è¨€æ‹¾é—

---

# (0) `main` å‡½æ•°

æ‰€æœ‰Cç¨‹åºéƒ½æ˜¯ä»`main`å¼€å§‹æ‰§è¡Œçš„ï¼Œé‚£è°æ‰§è¡Œçš„mainå‘¢ï¼Ÿ

```c
int main(int argc, char *argv[]);
```

* argc (argument count): å‚æ•°ä¸ªæ•°
* argv (argument vector): å‚æ•°åˆ—è¡¨(NULLç»“æŸ)ï¼Œå®ƒæ˜¯ä¸€ä¸ª`char *`çš„æ•°ç»„

--

count: false

------

ç¼–è¯‘å¥½çš„Cç¨‹åºä¸ä»…å¯ä»¥â€œåŒå‡»â€è°ƒç”¨ï¼Œè¿˜å¯ä»¥ä¼ å…¥å‚æ•°

* `ls -al` (`argc = 2, argv = ["ls", "-al"]`)
* `python -c 'print(2**100)'` (`argc = 3`)

> æƒ³åˆ°ä¸Šä¸€æ¬¡è¯¾çš„ UNIX å“²â™‚å­¦äº†å—ï¼Ÿ

---

# (0) `main` å‡½æ•°

å¯ä»¥å†™ä¸€æ®µ[ä»£ç ](/static/wiki/ics/2019/files/test_args.c)æµ‹è¯•å‚æ•°ä¼ é€’

----

è§„å®šï¼š

* `argv[0], argv[1], ... argv[argc - 1]`æ˜¯ç¨‹åºæ‰§è¡Œçš„å‚æ•°
* `argv[argc] == NULL`
* `main` å‡½æ•°åœ¨æœ«å°¾æ²¡æœ‰ return çš„å‰æä¸‹ï¼Œè¿”å› 0

----

Shellå‘½ä»¤å°±æ˜¯è¿™æ ·å®ç°çš„ï¼

* `find . -name "*.cpp" | xargs cat | wc -l`
* å‘½ä»¤è¡Œå·¥å…·ä» `argc/argv` ä¸­è§£æå‚æ•°

---

# (0) å·§ç”¨ argc/argv

Linux æ”¯æŒ â€œShebangâ€ æ ¼å¼çš„è„šæœ¬ï¼š

```bash
#!interpreter [args]
...
```

ä¾‹å­ï¼š

```bash
#!/bin/bash
echo "Hello, World"
```

----

å¯ä»¥å®ç°â€œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¯æŒå„ç§å‘½ä»¤â€

* ls - `#!/bin/busybox ls`
* echo - `#!/bin/busybox echo`

---

# (1) é¢„ç¼–è¯‘

`#include <stdio.h>` åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

* `#include`  æ˜¯ä¸€æ¡.red[é¢„ç¼–è¯‘æŒ‡ä»¤]ï¼ŒæŠŠåé¢æŒ‡å®šçš„æ–‡ä»¶â€œç²˜è´´â€è¿›æ¥
* `#include <...>` å’Œ `#include "..."` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

----

å…¶ä»–é¢„ç¼–è¯‘æŒ‡ä»¤ï¼š

* `#define`â€”è¯¾ç¨‹çš„è€æœ‹å‹ï¼Œç»å¸¸ä¼šè§åˆ°
* `#ifdef ... #endif`

* `#if ... #else ... #endif`

---

# (1) é¢„ç¼–è¯‘ (cont'd)

æœ‰è¶£çš„é¢„ç¼–è¯‘

```c
#include <stdio.h>

int main() {
#if aa == bb
  printf("Yes\n");
#else
  printf("No\n");
#endif
}
```

`gcc -E` èƒ½å¤ŸæŸ¥çœ‹é¢„ç¼–è¯‘åçš„ç»“æœ

---

# (1) é¢„ç¼–è¯‘ (cont'd)

.red[å®å±•å¼€ = å¤åˆ¶/ç²˜è´´] (é€’å½’)

çŸ¥ä¹é—®é¢˜ï¼šå¦‚ä½•æå®ä¸€ä¸ª OJï¼Ÿ [oj-killer.c](/static/wiki/ics/2019/files/test_def.c)

```c
#define A "a"
#define B A A A A A A A A A A
#define C B B B B B B B B B B
#define D C C C C C C C C C C
...
```

* åœ¨æ•´ä¸ªè¯¾ç¨‹ä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°æ›´å¤šæœ‰è¶£çš„ä¾‹å­
    * AbstractMachine ä»£ç 
    * NEMU æ¡†æ¶ä»£ç 
    * â€¦â€¦

---

# (2) ç¨‹åºçš„æ‰§è¡Œ

ç†è§£ C ç¨‹åºçš„è¿è¡Œæœ€é‡è¦çš„æ˜¯ç†è§£.red[å†…å­˜å¸ƒå±€]

* ä»£ç /æ•°æ®/å †æ ˆ
* C ç¨‹åºï¼šæ ¹æ®.blue[ä»£ç ]æŒ‡å®šçš„è§„åˆ™ï¼Œä¿®æ”¹æ•°æ®/å †æ ˆçš„.blue[çŠ¶æ€]

----

C è¯­è¨€çš„è¯­ä¹‰ (semantics)

* ç¨‹åºå§‹ç»ˆæœ‰ä¸€ä¸ªâ€œå½“å‰æ‰§è¡Œçš„ä½ç½®â€ (Program Counter, PC)

* èµ‹å€¼ = ä¿®æ”¹å†…å­˜ (æ•°æ®/å †æ ˆ) çŠ¶æ€

* å‡½æ•°è°ƒç”¨ = åˆ›å»ºæ ˆå¸§; å‡½æ•°è¿”å› = å›æ”¶æ ˆå¸§

---

# (2) ç¨‹åºçš„æ‰§è¡Œï¼šä¾‹å­

ä»£ç ã€æ•°æ®ã€å †æ ˆåœ¨åŒä¸€ä¸ª.blue[åœ°å€ç©ºé—´] (address space) ä¸­ã€‚

* å¯ä»¥æŠŠä¸€ä¸ªåœ°å€è§£é‡Šæˆä¸åŒçš„å«ä¹‰ (ç±»å‹)

----

```c
#include <stdio.h>

void foo() { printf("Hi\n"); }
int x = 1024;

int main() {
  void *p;
  p = foo; ((void (*)())p)(); // ä»£ç 
  p = &x;  printf("%p %lx\n", p, *(intptr_t *)p); // æ•°æ®
  p = &p;  printf("%p %lx\n", p, *(intptr_t *)p); // å †æ ˆ
}
```

---

# (3) å˜é‡å’Œç±»å‹

å†…å­˜ä¸­çš„æ•°æ®æœ‰.red[ç±»å‹]

* åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œå†…å­˜å°±æ˜¯ä¸€ä¸ª `char[]`
* C è¯­è¨€ä¸­ï¼Œå¯ä»¥é€šè¿‡ç±»å‹.red[æ›´å®‰å…¨/æ›´æ–¹ä¾¿åœ°è®¿é—®å†…å­˜]

----

.blue[Quiz]ï¼šä»¥ä¸‹`argv`å‚æ•°éƒ½å¯ä»¥ä½œä¸º`main`çš„å‚æ•°ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªäº›`argv`æ‰§è¡Œ`strcpy(argv[0], "a");`æ˜¯åˆæ³•çš„ï¼Ÿ

1. (æ ·ä¾‹) `char *argv[]`
2. (ç»å¸¸è§åˆ°çš„) `char **argv`
3. (?) `const char *argv[]`
4. (??) `char ** const argv`
5. (???) `const char ** const argv`
6. (????) `const char * const * const argv`

---

# (3) å˜é‡å’Œç±»å‹ (cont'd)

é™„åŠ é¢˜ï¼šè¿™æ˜¯å•¥ï¼Ÿ

```c
void (*signal(int sig, void (*func)(int)))(int);
```

--
count:false
----

è¯´äººè¯ï¼š

```c
typedef void (*sig_t)(int);
sig_t signal(int sig, sig_t func);
```

* è¿™è¾ˆå­è¦é‡åˆ°è¿”å›ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆçš„æƒ…å†µè¿˜æ˜¯æœ‰çš„
* STFW: â€œé¡ºæ—¶é’ˆæ³•åˆ™â€

---

# (4) ç¨‹åº

ç¨‹åºæ˜¯.blue[â€œæ‰‹å†Œâ€]ï¼Œå®šä¹‰äº†è®¡ç®—æœºåº”è¯¥åšä»€ä¹ˆ

* æˆ‘ä»¬åšçš„æ— éå°±æ˜¯æŠŠæ•°æ®ç®—å‡ºæ¥ï¼Œç®—åˆ°å¦ä¸€ä¸ªåœ°æ–¹
* å…¶ä»–åŠŸèƒ½é€šè¿‡åº“å‡½æ•°å®ç°
    * è¯»å–è¾“å…¥ã€å±å¹•æ‰“å°ã€GUI æ˜¾ç¤ºâ€¦â€¦ (æš‚æ—¶ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠ)

----

å³ä¾¿åªå…è®¸ä½ è°ƒç”¨ `gettime()`, `read_key()` å’Œ `draw_pixel(x, y, color)`ï¼Œä½ å°±èƒ½å®ç°.red[å‡ ä¹ä»»ä½•ç¨‹åº]

* ç®—æ³•
* æ¸¸æˆ (LiteNES)
* â€¦â€¦

---

# å¸¸è§çš„è¯¯è§£

â€œæˆ‘ä»¬åªè¦èƒ½å†™å‡ºç¨‹åºå°±è¡Œäº†ï¼Œè¯­è¨€ç‰¹æ€§å…³æˆ‘Xäº‹ï¼â€

----

äº‹å®ï¼š

1. æ€»æ˜¯å¯ä»¥ç”¨ç®€å•ç²—æš´çš„ç¼–ç¨‹æ–¹å¼å†™å‡ºæ­£ç¡®çš„ç¨‹åº
2. éšç€é¡¹ç›®çš„å¢é•¿ï¼Œè¿™ä¹ˆåšå¯èƒ½ä¼šè®©ä½ çš„ä»£ç æ·±é™·æ³¥æ½­

----

ä¸ºä»€ä¹ˆè¦å¥½å¥½å­¦ä¹ å­¦Cè¯­è¨€ï¼Ÿ

1. .red[ç®€å•]ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹åœ¨å¯æ§æ—¶é—´æˆæœ¬é‡Œå¯ä»¥ç²¾é€šçš„è¯­è¨€
2. .red[é€šç”¨]ã€‚å¤§é‡ç³»ç»Ÿæ˜¯ç”¨ C è¯­è¨€ç¼–å†™çš„ï¼Œä¾‹å¦‚ Python
3. .red[å¯¹åº•å±‚æœºå™¨çš„ç²¾ç¡®æ§åˆ¶]ã€‚C è¯­è¨€å‡ ä¹å°±æ˜¯æ±‡ç¼–ï¼Œèƒ½å¤Ÿæ§åˆ¶å®ƒåœ¨æœºå™¨ä¸Šçš„è¡Œä¸º

</textarea>

<script src="../static/js/remark-latest.min.js"></script>

<script>
  var slideshow = remark.create();
</script>

    <script>
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      })

      $("math").each(function() {
        var tex = $(this).text();
        var html = katex.renderToString(tex, {
          displayMode: $(this).attr('class') == 'block-math',
          throwOnError: false
        });
        $(this).replaceWith(html);
      });

      function get_token() {
        var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
        if (match) return match[2];
        else return "";
      }

      var token = get_token();
      var hint = "token", box = $("#token-input");

      if (token == "") { box.val(hint); }
      else { box.val(token); }

      function login() {
        var token = box.val()
        document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;';
        if (token == '') {
          box.val(hint);
        }
      }
    </script>
  </body>
</html>