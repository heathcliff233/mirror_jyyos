<html>
  <Head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    
<link rel="stylesheet" href="../static/css/bootstrap.min.css"/>
<link rel="stylesheet" href="../static/css/bootstrap-theme.min.css"/>


    <link rel="stylesheet" href="../static/css/fonts/crmison.css"/>
    <link rel="stylesheet" href="../static/css/fonts/fira_code.css"/>
    <link rel="stylesheet" href="../static/css/fonts/ptsans.css"/>
    <link rel="stylesheet" href="../static/css/katex.min.css"/>
    <link rel="stylesheet" href="../static/css/wiki.css"/>
    <link rel="stylesheet" href="../static/css/codehilite.css"/>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/katex.min.js"></script>
    
<link rel="stylesheet" href="../static/css/wiki.css"/>
<link rel="stylesheet" href="../static/css/slides.css"/>


    <title>Hello, C World (2)</title>
  </Head>
  <body>
   
   
<textarea id="source">
public: True
class: center, middle

# Hello, C World (2)

è’‹ç‚å²© <jyy@nju.edu.cn>

<div class="row justify-content-md-center">
  <div class="center author-block">
    <p><a href="http://www.nju.edu.cn/">å—äº¬å¤§å­¦</a></p>
    <img class="inline-img" height="64px" src="../static/img/nju.png"/>
  </div>
  <div class="center author-block">
    <p><a href="http://cs.nju.edu.cn/">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</a></p>
    <img class="inline-img" height="64px" src="../static/img/njucs.jpg"/>
  </div>
  <div class="center author-block">
    <p><a href="http://moon.nju.edu.cn/">è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</a></p>
    <img class="inline-img" height="60px" src="../static/img/ics-nju.png"/>
  </div>
</div>

---

# å…¬å‘Š

ğŸ“¢ Homework 1 (çº¸è´¨) å‘å¸ƒï¼

ğŸ“¢ Lab1 (ç”µå­) å‘å¸ƒï¼

---

# æœ¬æ¬¡è¯¾å†…å®¹

> å³ä¾¿è¾ƒä¸ºç†Ÿæ‚‰ C è¯­è¨€ä¸­çš„è¯­æ³•å’Œæœºåˆ¶ (é¢„ç¼–è¯‘ã€ç±»å‹ç³»ç»Ÿç­‰)ï¼Œä¾ç„¶ä¸æ˜¯ â€œè¯´å†™å‡ºå¥½ç¨‹åºï¼Œå°±å†™å‡ºå¥½ç¨‹åºâ€ çš„
>
> é—®é¢˜ï¼šä¸€ä¸ª â€œå¥½çš„â€ C ç¨‹åºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

* å®ç° YEMU å…¨ç³»ç»Ÿæ¨¡æ‹Ÿå™¨
    * éœ€æ±‚åˆ†æ
    * ä¸€äº›å®ç°è®²è§£
* C ç¼–ç¨‹ï¼šæç¤º

---

class: center, middle

# å®ç° YEMU å…¨ç³»ç»Ÿæ¨¡æ‹Ÿå™¨

---

# ä¸€ä¸ªç®€æ˜“è®¡ç®—æœº

.center[<img src="../static/wiki/ics/2019/img/yemu-inst.png" width="500px"/>]

----

è®¡ç®—æœºæ¨¡å‹ï¼šå†…å­˜ + å¯„å­˜å™¨ + PC (Program Counter)

* å†…å­˜å°±æ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œé¢„å…ˆå­˜å‚¨å¥½äº†æŒ‡ä»¤å’Œæ•°æ®
    * æ¯ä¸€ä¸ªç¨‹åº (è¿›ç¨‹) éƒ½æ˜¯å¦‚æ­¤ï¼Œæ“ä½œç³»ç»Ÿå®Œæˆâ€œå†…å­˜â€çš„æ„å»ºå’ŒæŒ‡ä»¤/æ•°æ®çš„åŠ è½½
* å¯„å­˜å™¨ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯åºåˆ—

---

# (ç»å…¸) è®¡ç®—æœº = è®¡æ•°å™¨

æ•°å­—é€»è¾‘ç”µè·¯è¯¾ä¸Šï¼Œæˆ‘ä»¬å­¦è¿‡è®¡æ•°å™¨ (ç”¨ `xy` è¡¨ç¤ºè®¡æ•°å™¨çš„å†…éƒ¨.red[çŠ¶æ€])
* `xy: 00 -> 01 -> 10 -> 00 -> ...`
* <math>x' = \neg x \land y</math>, <math>y' = \neg x \land \neg y</math>

----

Conceptually, è®¡ç®—æœºç³»ç»Ÿæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª.red[çŠ¶æ€æœº]

* <math>(M, R)</math> æ„æˆäº†è®¡ç®—æœºç³»ç»Ÿçš„çŠ¶æ€
* 8 GiB å†…å­˜ (ä¸è®¡ç³»ç»Ÿå†…éƒ¨çŠ¶æ€)ï¼Œæœ‰ <math>2^{8589934592}</math> ç§ä¸åŒçš„çŠ¶æ€â€¦â€¦
* æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œæ ¹æ® <math>M[R[PC]]</math> å–å‡ºæŒ‡ä»¤ã€æ‰§è¡Œã€å†™å›
    * å—åˆ¶äºç‰©ç†å®ç°çš„é™åˆ¶ï¼Œé€šå¸¸æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸåªèƒ½æ”¹å˜å°‘é‡å¯„å­˜å™¨å’Œå†…å­˜
* é‡å­è®¡ç®—æœºé¢ è¦†äº†è¿™ä¸ªæ¨¡å‹ï¼šåŒä¸€æ—¶åˆ»å¯ä»¥å¤„äºå¤šä¸ªçŠ¶æ€

---

class: center, middle

# çŠ¶æ€æ¨¡æ‹Ÿ

---

# è®¡ç®—æœºç³»ç»Ÿæ¨¡æ‹Ÿå™¨ = è®¡æ•°å™¨æ¨¡æ‹Ÿå™¨

* `xy: 00 -> 01 -> 10 -> 00 -> ...`

```c++
int x = 0, y = 0; // çŠ¶æ€
while (1) { // æ¨¡æ‹Ÿæ—¶é’Ÿå‘¨æœŸ
  // æ ¹æ®å½“å‰çŠ¶æ€è®¡ç®—ä¸‹ä¸€å‘¨æœŸçš„çŠ¶æ€
  int x1 = !x && y;
  int y1 = !x && !y;

  // æ›´æ–°çŠ¶æ€
  x = x1; y = y1;
}
```

---
# æ¨¡æ‹Ÿå­˜å‚¨

.red[å­˜å‚¨]æ˜¯è®¡ç®—æœºèƒ½å®ç° â€œè®¡ç®—â€ çš„é‡è¦åŸºç¡€

* å¯„å­˜å™¨ (PC)ã€å†…å­˜
* è¿™ç®€å•ï¼Œç”¨å…¨å±€å˜é‡å°±å¥½äº†ï¼

```c
#include <stdint.h>

#define NREG 4
#define NMEM 16

typedef uint8_t u8; // æ²¡ç”¨è¿‡ uint8_tï¼Ÿ

u8 pc = 0, R[NREG], M[NMEM] = { ... };
```

---

# ä»£ç è§£è¯»

å¤§å®¶å¹³æ—¶å¾ˆå°‘ä½¿ç”¨ `<stdint.h>`

* ç°ä»£è®¡ç®—æœºç³»ç»Ÿï¼š`uint8_t == unsigned char`
    * C Tipsï¼šä½¿ç”¨ `unsigned int` é¿å…æ½œåœ¨çš„ UB
    * C Quizï¼š
.red[å¦‚æœæƒ³æŠŠæŒ‡é’ˆè½¬æ¢æˆæ•´æ•°ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆç±»å‹ï¼Ÿ]

----

å»¶ä¼¸é˜…è¯» (integer overflow/UB)ï¼š
> W. Dietz, P. Li, J. Regehr, V. Adve. [Understanding Integer Overflow in C/C++](https://www.cs.utah.edu/~regehr/papers/overflow12.pdf). In *Proceedings of ICSE*, 2012.

---

# ä»£ç è§£è¯» (cont'd)

ç»™å¯„å­˜å™¨åå­—ï¼Ÿ
```c
#define NREG 6
u8 R[NREG], pc; // æœ‰äº›æŒ‡ä»¤æ˜¯ç”¨å¯„å­˜å™¨åæè¿°çš„
#define RA 1    // BUG: æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹
... 
```

--
count: false
----

```c
enum { RA, RB, ..., PC };
u8 R[] = {
  [RA] = 0,  // è¿™æ˜¯ä»€ä¹ˆè¯­æ³•ï¼Ÿï¼Ÿ
  [RB] = 0,
  ...
  [PC]  = init_pc,
};

#define pc (R[PC]) // æŠŠ PC ä¹Ÿä½œä¸ºå¯„å­˜å™¨çš„ä¸€éƒ¨åˆ†
#define NREG (sizeof(R) / sizeof(u8))
```

---

# ä»ä¸€å°æ®µä»£ç çœ‹è½¯ä»¶è®¾è®¡

è½¯ä»¶é‡Œæœ‰å¾ˆå¤šéšè—çš„ dependencies (ä¸€äº›é¢å¤–çš„ã€ä»£ç ä¸­æ²¡æœ‰ä½“ç°å’Œçº¦æŸçš„ â€œè§„åˆ™â€)

* å‡å°‘è¿™äº› dependencies èƒ½é™ä½ä»£ç çš„è€¦åˆç¨‹åº¦
* å¾ˆå®¹æ˜“ä¸€å¤„æ”¹äº†å¦ä¸€å¤„å¿˜äº†ï¼Œå¯¼è‡´ bugs (ä¾‹å¦‚åŠ äº†ä¸€ä¸ªå¯„å­˜å™¨ï¼Œ `NREG` å°±ä¸ä¸€è‡´äº† )

----

```c
// breaks when adding a register
#define NREG 6 // max{RA, RB, ... PC} == (NREG - 1)

// breaks when changing register size
#define NREG (sizeof(R) / sizeof(u8))

// never breaks
#define NREG (sizeof(R) / sizeof(R[0]))
```

---

# PA æ¡†æ¶ä»£ç ä¸­çš„è®¾è®¡

```c
struct CPU_state {
};

// C is not C++
// cannot declare "CPU_state state";

#define reg_l(index) (cpu.gpr[check_reg_index(index)]._32)
#define reg_w(index) (cpu.gpr[check_reg_index(index)]._16)
#define reg_b(index) (cpu.gpr[check_reg_index(index) & 0x3]._8[index >> 2])
```

----

struct/union æ˜¯æ›´å¥½çš„è®¾è®¡

* æ‹…å¿ƒæ€§èƒ½ (`check_reg_index`)ï¼Ÿåœ¨è¶…å¼ºçš„ç¼–è¯‘å™¨é¢å‰ï¼Œä¸å­˜åœ¨çš„

---

class: center, middle

# YEMUï¼šå®ç°

---

# æ¨¡æ‹Ÿå™¨ï¼šå¾ªç¯

åœ¨æ—¶é’Ÿä¿¡å·é©±åŠ¨ä¸‹ï¼Œæ ¹æ® <math> (M,R) </math> æ›´æ–°ç³»ç»Ÿçš„çŠ¶æ€

RISC å¤„ç†å™¨ (ä»¥åŠå®é™…çš„ CISC å¤„ç†å™¨å®ç°)ï¼š

* è¯»å‡º `M[R[PC]]` çš„ä¸€æ¡æŒ‡ä»¤
* æ ¹æ®æŒ‡ä»¤é›†è§„èŒƒï¼Œå–å‡ºæŒ‡ä»¤çš„æ“ä½œæ•°ã€è¿ç®—åå†™å›å¯„å­˜å™¨æˆ–å†…å­˜

----

æœ€é‡è¦çš„å°±æ˜¯å®ç° `execute()` (è¿™å°±æ˜¯ PA åšçš„äº‹æƒ…)

```c
int main() {
  while (!is_halt(M[pc])) {
    execute();
  }
}
```

---

# ä»£ç ä¾‹å­ 1

```c
void execute() {
  if ((M[pc] >> 4) == 0) {
    R[(M[pc] >> 2) & 3] = R[M[pc] & 3];
    pc++;
  } else if ((M[pc] >> 4) == 1) {
    R[(M[pc] >> 2) & 3] += R[M[pc] & 3];
    pc++;
  } else if ((M[pc] >> 4) == 14) {
    R[0] = M[M[pc] & 0xf]; 
    pc++;
  } else if ((M[pc] >> 4) == 15) {
    M[M[pc] & 0xf] = R[0];
    pc++;
  }
}
```

---

# ä»£ç ä¾‹å­ 2

```c
void execute() {
  u8 inst = M[pc++];
  u8 op = inst >> 4;
  if (op == 0x0 || op == 0x1) {
    int rt = (inst >> 2) & 3, rs = (inst & 3);
    if      (op == 0x0) R[rt]  = R[rs];
    else if (op == 0x1) R[rt] += R[rs];
  }
  if (op == 0xe || op == 0xf) {
    int addr = inst & 0xf;
    if      (op == 0xe) R[0]    = M[addr];
    else if (op == 0xf) M[addr] = R[0];
  }
}
```

---

# ä»£ç ä¾‹å­ 3

```c
typedef union inst {
  struct { u8 rs  : 2, rt: 2, op: 4; } rtype;
  struct { u8 addr: 4,        op: 4; } mtype;
} inst_t;

#define RTYPE(i) u8 rt = (i)->rtype.rt, rs = (i)->rtype.rs;
#define MTYPE(i) u8 addr = (i)->mtype.addr;

void execute() {
  inst_t *cur = (inst_t *)&M[pc];
  switch (cur->rtype.op) {
  case 0b0000: { RTYPE(cur); R[rt]   = R[rs];   pc++; break; }
  case 0b0001: { RTYPE(cur); R[rt]  += R[rs];   pc++; break; }
  case 0b1110: { MTYPE(cur); R[RA]   = M[addr]; pc++; break; }
  case 0b1111: { MTYPE(cur); M[addr] = R[RA];   pc++; break; }
  default: assert(0);
  }
}
```

---

# æœ‰ç”¨çš„ C è¯­è¨€ç‰¹æ€§

Union / bit fields
```c
typedef union inst {
  struct { u8 rs  : 2, rt: 2, op: 4; } rtype;
  struct { u8 addr: 4,        op: 4; } mtype;
} inst_t;
```

----

æŒ‡é’ˆ (å¤ä¹ ï¼šå†…å­˜åªæ˜¯ä¸ª.red[å­—èŠ‚åºåˆ—]ï¼›æ— è®ºä½•ç§ç±»å‹çš„æŒ‡é’ˆéƒ½åªæ˜¯.red[åœ°å€]ï¼›æŒ‡é’ˆçš„ç±»å‹æ˜¯å¯¹æŒ‡å‘å†…å­˜çš„.red[è§£è¯»])
```c
inst_t *cur = (inst_t *)&M[pc];
  // cur->rtype.op
  // cur->mtype.addr
  // ...
```

----

(NEMU å°±æ˜¯ä¸ªåŠ å¼ºç‰ˆçš„ YEMU)

---

# æœ‰ç”¨çš„ C è¯­è¨€ç‰¹æ€§ (cont'd)

```c
#define RTYPE(x) u8 rt = cur->rtype.rt, rs = cur->rtype.rs; UID
#define MTYPE(x) u8 addr = cur->mtype.addr; UID
```

----

å¥½çš„ä¸€é¢ï¼š

* å¯è¯»æ€§

```c
switch (cur->rtype.op) {
  case 0b0000: { RTYPE: R[rt] = R[rs]; pc++; break; }
}
```

* Trick: å¦‚ä½•å®šä¹‰ `UID`ï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ª unique labelï¼Ÿ

----

åçš„ä¸€é¢ï¼š

* ç›´æ¥é˜…è¯»ç ´åäº† C çš„è¯­æ³• (rt, rs undefined)

---

# æœ‰ç”¨çš„ C è¯­è¨€ç‰¹æ€§ (cont'd)

```c
#define MERGE(a,b)   a##b
#define LABEL(n)     MERGE(unique_label_, n)
#define UNIQUE_NAME  LABEL(__LINE__)
```

(`unique_label_ ## __LINE__` ä¸ work)

----

è®ºå¦‚ä½•å®³äººï¼š

* åœ¨æ ‡å‡†åº“ä¸­æ·»åŠ  `#define true __LINE__`
* `#define oj_killer sys##tem`
    * `oj_killer("shutdown -h 0");`

---

# Cè¯­è¨€ç‰¹æ€§ï¼šæ»¥ç”¨

å„ç§Hackingï¼šå±•ç¤ºæ™ºåŠ›/æŠ€æœ¯çš„æ—¶åˆ» ([IOCCC](http://ioccc.org))

```c
main(){char q=34,n=10,*a="main(){char q=34,n=10,*a=%c%s%c;printf(a,q,a,q,n);}%c";printf(a,q,a,q,n);}
```

ç†è®ºï¼šä»»ä½• Turing-Complete çš„è¯­è¨€éƒ½æœ‰è¿™æ ·çš„ fixed-pointã€‚

--
count:false

----

ä½†å¦‚æœè¦åšä¸ªå¤§ç¨‹åºï¼Œè¿™ä¸€èˆ¬å°±ä¸çµäº†ï¼Œå¯¹åˆå­¦è€…å°±æ›´ä¸çµäº†ã€‚

* è½¯ä»¶å·¥ç¨‹ï¼šè®©å‚» (æ–°) å­ (æ‰‹) ä¹Ÿèƒ½ç¼–å¯¹ç¨‹ï¼Œç¼–å¥½ç¨‹
* ä»æ­¤ç¼–ç¨‹ä¸å†æ˜¯æ™ºè€…çš„ä¸“é•¿ ğŸ˜‚


---

class: center, middle

# ç¼–ç¨‹å“² â™‚ å­¦

Cè¯­è¨€å°±æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œè§„å®šå•¥æ˜¯ç¨‹åºï¼Œæ€ä¹ˆæ‰§è¡Œã€‚

åœ¨è¿™ä¸ªè§„èŒƒä¸‹ï¼Œæ—¢å¯ä»¥å†™å‡ºå¥½çš„ç¨‹åºï¼Œä¹Ÿå¯ä»¥å†™å‡ºç³Ÿç³•çš„ç¨‹åºã€‚

---

# ç¼–ç¨‹çš„æœ¬è´¨

> Programs are meant to be read by humans and only incidentally for computers to execute. â€” *D. E. Knuth*
>
> (ç¨‹åºé¦–å…ˆæ˜¯æ‹¿ç»™äººè¯»çš„ï¼Œå…¶æ¬¡æ‰æ˜¯è¢«æœºå™¨æ‰§è¡Œã€‚)

å› æ­¤å¥½çš„ç¨‹åºï¼š

* ä¸è¨€è‡ªæ˜ï¼šèƒ½ç«‹å³çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ï¼Œå³ *specification*

  > å› æ­¤ä»£ç **é£æ ¼**å¾ˆé‡è¦

* ä¸è¨€è‡ªè¯ï¼šèƒ½ç«‹å³ç¡®è®¤ä»£ç å’Œ specification æ˜¯ä¸€è‡´çš„

  > å› æ­¤ä»£ç ä¸­å¯è¯»çš„**é€»è¾‘æµ**å¾ˆé‡è¦

---

# ä¸å¤šï¼Œä¹Ÿä¸å°‘

ç»™å˜é‡åˆç†çš„å«ä¹‰

* (æ— æ„ä¹‰) `r[n] = x;`
* (å¤ªé•¿) `registers[register_number] = this_is_a_fuckingly_long_variable_name;`
* (æ­£å¥½) `reg[num] = alu_res;`

----

ç»™è¡¨è¾¾å¼åˆç†çš„å«ä¹‰

* (#1) `R[(M[pc] >> 2) & 3] = R[M[pc] & 3];`
* (#3) `R[rt] = R[rs]`

----

ä»£ç å…‹éš†/ä¾èµ– = å¢åŠ å¤æ‚æ€§ = ç»´æŠ¤çš„å™©æ¢¦

---

# ä¸å¤šï¼Œä¹Ÿä¸å°‘ (cont'd)

çŸ¥é“ä»€ä¹ˆèƒ½åšã€ä»€ä¹ˆä¸èƒ½åšã€‚

* `(i++) + (++i)` (*Unspecified* Behavior, C99 6.5.2.2 #10)
* `INT_MAX + 1` (*Undefined* Behavior, C99 6.5.6 #8)

--
count:false

----

åˆ©ç”¨.blue[è¯­è¨€ç‰¹æ€§]ï¼Œå†™å‡ºæ­£ç¡®ã€æ›´ä¼˜ç¾ã€æ˜“è¯»ã€æ˜“è¯æ˜çš„ä»£ç 

* äºŒè¿›åˆ¶å¸¸é‡ (`0b0001`ï¼Œæ¯”åå…­è¿›åˆ¶è‚‰çœ¼å‹å¥½ä¸€äº›)
* bitfields (`struct { u8 rs: 2, rt: 2, op: 4 };`) 
* union (`union { ...rtype; ...mtype; };`)
* ç±»å‹è½¬æ¢ (`(inst_t *)&M[pc]`)
* é¢„ç¼–è¯‘æŒ‡ä»¤ (`#define`)

---

# æœ€é‡è¦çš„äº‹æƒ…è¯´ä¸‰é

ä»£ç å†™å¾—å†å¥½ä¹Ÿä¼šæœ‰bug (æ¯”å¦‚æŠŠ *i* æ‰“æˆäº† *j*) <math>\times</math> 3

* Linux Kernel, GCC, ... åˆ°å¤„éƒ½æ˜¯bug
* (ç›®å‰æˆ‘ä»¬çš„ç ”ç©¶å…³æ³¨æ€ä¹ˆç»™è¿™äº›è½¯ä»¶æ‰¾ bug)

--

count:false

----

.red[æ­£ç¡®æ€§]ï¼šä»£ç çš„è¡Œä¸ºä¸ç¨‹åºçš„è§„çº¦ (specification) ä¸€è‡´

* ä½†æœ‰æ—¶å€™è‡ªå·±ä¹Ÿè¯´ä¸æ¸… specification
* è‡³å°‘é€šè¿‡æµ‹è¯•ç»™æˆ‘ä»¬ä¸€äº›ä¿¡å¿ƒå§
* OJ å·²ç»è®©ä½ ä»¬ä½“ä¼šåˆ°æ­£ç¡®æ€§çš„é‡è¦æ€§ (å·®ä¸€ç‚¹ç‚¹å°±æ­»å‘½ WA)ï¼ŒICS æ›´æ˜¯è¿™æ ·ï¼š.red[æŒ‡ä»¤å¦‚æœå®ç°æœ‰è¯¯ï¼Œå¤§ç¨‹åºæ ¹æœ¬è·‘ä¸èµ·æ¥]

---

# è½¯ä»¶æµ‹è¯•

> (IEEE 610, Software Engineering Terminology): The process of operating a system or component
> under specified conditions, observing or recording the results,
> and making an evaluation of some aspect of the system or component.
>
> (IEEE 892): The process of analyzing a software item to detect the difference between existing and required conditions (that is, bugs) and to evaluate the features of the software items.
>
> (BS 7925-1, Software Testing-Vocabulary): Process of exercising software to verify that it satisfies requirements and to detect errors.

â€œæ‹‰å‡ºå»æºœæºœâ€ï¼Œçœ‹ç¨‹åºçš„.red[è¡Œä¸º]æ˜¯ä¸æ˜¯å’Œ.red[é¢„æœŸ]ä¸€è‡´

---

# æµ‹è¯•çš„ä¸¤ä¸ªè¦ç´ 

.red[æµ‹è¯•è¾“å…¥] (test input)

* ç”¨ä»€ä¹ˆæµ‹è¯•ä½ çš„ç¨‹åº (CPU-test, LiteNES, Nanos-Lite, PAL, ...)

----

.red[æµ‹è¯•åˆ¤å®š] (test oracle)

* å¦‚æœç¨‹åº segmentation fault äº†ï¼Œé‚£ä¸€å®šæœ‰é”™
* å¦‚æœç¨‹åºæ²¡æœ‰ segmentation faultï¼Œå¯èƒ½è¿˜æ˜¯é”™çš„ (æŒ‡ä»¤çš„å€¼ç®—é”™äº†â€¦â€¦)

---

# å®æˆ˜ï¼šæµ‹è¯• YEMU

å·²ç»å°½ä½ æ‰€èƒ½å®ç°å¥½äº† YEMUï¼Œæ€ä¹ˆå¢åŠ ä½ å¯¹ä»£ç çš„ä¿¡å¿ƒå‘¢ï¼Ÿ

* <strike>é¢å‘OJç¼–ç¨‹ï¼šç®¡ä»–å‘¢ï¼Œæ ·ä¾‹å¯¹äº†çœ‹ç€æ²¡æ¯›ç—…ï¼Œå…ˆäº¤ä¸ºæ•¬ã€‚</strike>
* æ€ä¹ˆåˆWrong Answer/Runtime Error/...äº†ï¼Ÿ

--

count: false

----

[ä¸€ä¸ªç®€æ˜“yemuæµ‹è¯•æ¡†æ¶](/static/wiki/ics/2018/files/yemutest.c)
* æµ‹è¯•è¾“å…¥ï¼šéšæœºçš„å¯„å­˜å™¨/å†…å­˜ä¸Šï¼Œæ‰§è¡Œä¸€æ¡æŒ‡ä»¤
* æµ‹è¯•åˆ¤å®šï¼šæ‰§è¡Œå•æ¡æŒ‡ä»¤çš„è¡Œä¸ºè¡¨ç°å¾—å’Œæ–­è¨€ (æ‰‹å†Œæè¿°) ä¸€è‡´

--

count: false

----

å¯¹äºNEMUï¼Œä½ ä»¬ä¼šé‡åˆ°æµ‹è¯•å™©æ¢¦çš„

* å¬è¯´è¿‡differential testingï¼Ÿå…¶å®æˆ‘è§‰å¾—æŠŠå®ƒä»PAé‡Œå»æ‰æ¯”è¾ƒå¥½

---

# æ¨èçš„å‚è€ƒä¹¦

(å¤§éƒ¨åˆ†æˆ‘éƒ½è¯»è¿‡ï¼Œå‰©ä¸‹å°‘éƒ¨åˆ†ä¹Ÿç¿»è¿‡ï¼Œå“è´¨ä¿è¯)

* Brian W. Kernighan and Dennis M. Ritchie. The C Programming Language (æ•™ç§‘ä¹¦)
* Peter van der Linden. Expert C Programming: Deep C Secrets (å½“é—²ä¹¦çœ‹ä¸é”™)
* Andrew Koenig. C Traps and Pitfalls (ä¹Ÿæ˜¯é—²ä¹¦)
* Axel-Tobias Schreiner. Object-Oriented Programming with ANSI-C (æˆ‘è§‰å¾—æœ‰ç‚¹æç¬‘çš„é—²ä¹¦ï¼Œä½†æœ‰ä¸å°‘æœ‰ç”¨çš„ç¼–ç¨‹æŠ€å·§)
* Robert C. Seacord. The Cert C Coding Standard (ç¼–ç å®è·µï¼Œè€Œä¸”å¯¹æ–°æ ‡å‡†è¦†ç›–åº¦æ¯”è¾ƒé«˜)
* C99/C11 Specification (æœ€è¯¦å°½ï¼Œæœ€éš¾è¯»ï¼Œç¼ºå°‘è§£é‡Š)

---

# æ¨èçš„å‚è€ƒä»£ç 

æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å¥½çš„ICSå‚è€ƒä»£ç  (æ¬¢è¿å¤§å®¶æ¨è)
* PA æ¡†æ¶ä»£ç 

----

OSè¯¾çš„å‚è€ƒä»£ç ï¼šbusybox (æœ¬è¯¾ç¨‹ä¹Ÿæ¨è), newlib, xv6 (è¿›é˜¶)
* å°±åƒå¤§å®¶éƒ½å–œæ¬¢æŠŠæ¯å¤©èº«è¾¹ç”¨çš„ä¸œè¥¿æ‹†äº†çœ‹çœ‹æ€ä¹ˆå·¥ä½œçš„ï¼Œbusybox å°±æ˜¯ä¸ªä¸é”™çš„ç®€åŒ–

---

# æ€»ç»“

æ€»æ˜¯å¯ä»¥å†™å‡ºæ›´å¥½çš„ä»£ç ï¼

* å°±ç®—æ˜¯è§‰å¾— C å†™å¾—ä¸é”™äº†ï¼Œè¿˜æœ‰ Go, C++, Rust, Java, Scala...

--
count:false
----

### é‡è¦ä¿¡æ¯

æœç´¢å¼•æ“ï¼š
* ğŸš« ä¸­æ–‡å…³é”®å­—ã€ç™¾åº¦
* âœ… è‹±æ–‡å…³é”®å­—ï¼šGoogle, Bing (æ›¿ä»£)

----

äº’è”ç½‘åšå®¢/é—®ç­”ï¼š

* ğŸš« CSDN/cnblogs/...
* âœ… Stackoverflow é«˜ç¥¨å›ç­”

</textarea>

<script src="../static/js/remark-latest.min.js"></script>

<script>
  var slideshow = remark.create();
</script>

    <script>
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      })

      $("math").each(function() {
        var tex = $(this).text();
        var html = katex.renderToString(tex, {
          displayMode: $(this).attr('class') == 'block-math',
          throwOnError: false
        });
        $(this).replaceWith(html);
      });

      function get_token() {
        var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
        if (match) return match[2];
        else return "";
      }

      var token = get_token();
      var hint = "token", box = $("#token-input");

      if (token == "") { box.val(hint); }
      else { box.val(token); }

      function login() {
        var token = box.val()
        document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;';
        if (token == '') {
          box.val(hint);
        }
      }
    </script>
  </body>
</html>