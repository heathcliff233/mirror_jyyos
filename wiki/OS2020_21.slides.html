<html>
  <Head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    
    

    <link rel="stylesheet" href="../static/css/fonts/crmison.css"/>
    <link rel="stylesheet" href="../static/css/fonts/fira_code.css"/>
    <link rel="stylesheet" href="../static/css/fonts/ptsans.css"/>
    <link rel="stylesheet" href="../static/css/katex.min.css"/>
    <link rel="stylesheet" href="../static/css/wiki.css"/>
    <link rel="stylesheet" href="../static/css/codehilite.css"/>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/katex.min.js"></script>
    
<link rel="stylesheet" href="../static/css/reveal.css"/>
<link rel="stylesheet" href="../static/css/reveal-slides.css"/>


    <title>æ“ä½œç³»ç»Ÿè®¾è®¡ä¸å®ç°</title>
  </Head>
  <body>
   
   

<div class="reveal">
  <div class="slides">
    <section>
<div class="slide-container"><div class="center middle"><h1 id="_1">æ“ä½œç³»ç»Ÿè®¾è®¡ä¸å®ç°</h1>
<div plugin="include(page='Slides_Author')"><div class="hidden-in-outline author-block author-affiliation">
<p><a href="http://ics.nju.edu.cn/~jyy">è’‹ç‚å²©</a></p>
</div>
<div class="row hidden-in-outline author-block justify-content-md-center">
<p><div class="author-affiliation">    <a href="http://www.nju.edu.cn/"><p>å—äº¬å¤§å­¦</p>    <img alt="" class="inline-img" height="64px" src="../static/wiki/common/slides-author/nju-logo.png"></img></a>
  </div>
  <div class="author-affiliation">
   <a href="http://cs.nju.edu.cn/"><p>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³»</p>
    <img alt="" class="inline-img" height="64px" src="../static/img/njucs.jpg"></img></a>
  </div>
  <div class="author-affiliation">
    <a href="http://moon.nju.edu.cn/"><p>è®¡ç®—æœºè½¯ä»¶ç ”ç©¶æ‰€</p>
    <img alt="" class="inline-img" height="64px" src="../static/img/ics-nju.png"></img></a>
  </div></p>
</div></div></div></div>
</section>

<section>
<div class="slide-container"><div class=""><h2 id="_1">æœ¬è®²æ¦‚è¿°</h2>
<blockquote>
<p>æ“ä½œç³»ç»Ÿï¼šåº”ç”¨å’Œç¡¬ä»¶ä¹‹é—´çš„æŠ½è±¡å±‚</p>
<ul>
<li>Android app å’Œ Linux è¿›ç¨‹éƒ½æ˜¯ â€œåº”ç”¨ç¨‹åºâ€<ul>
<li>ä½†å®ƒä»¬ä½äºä¸åŒçš„æŠ½è±¡å±‚</li>
<li>æ“ä½œç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°éƒ½ä¸æ˜¯å”¯ä¸€çš„</li>
</ul>
</li>
</ul>
</blockquote>
<p>æœ¬è®²æ¦‚è¿°</p>
<ul>
<li>æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°<ul>
<li>Monolithic/micro/exo/unikernel</li>
</ul>
</li>
<li>å®ç°å¯é çš„æ“ä½œç³»ç»Ÿ</li>
</ul></div></div>
</section>

<section>
<section>
<div class="slide-container"><div class="center middle"><h1 id="_1">æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°</h1></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="android">å›é¡¾: Android</h2>
<p><img alt="" class="float-right" src="../static/wiki/os/2020/slides/img/android-arch.png" width="400px"></img></p>
<p>Android è®¾è®¡</p>
<ul>
<li>App = è¿›ç¨‹ & è™šæ‹Ÿæœº<ul>
<li>å¤§éƒ¨åˆ†æ˜¯ Java/Kotlin ä»£ç </li>
<li>é€šè¿‡ binder è°ƒç”¨ç³»ç»ŸæœåŠ¡ (ActivityManager, Camera, ...)</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨ Linux ç³»ç»Ÿè°ƒç”¨ (open, socket, read, write, ...)</li>
</ul>
</li>
</ul>
<p>Android å®ç° (å‚è€ƒ <a href="https://aosp-mirror.github.io/">AOSP</a>)</p>
<ul>
<li>åœ¨ Linux ä¸Šå®ç°<ul>
<li>ç¡¬ä»¶æŠ½è±¡å±‚</li>
<li>ç³»ç»ŸæœåŠ¡ (Java/Kotlin)</li>
</ul>
</li>
<li>ä½ ä¸€å®šä¸è§‰å¾—åœ¨ Linux Kernel é‡Œå®ç° Android Framework API æ˜¯ä¸ªå¥½ä¸»æ„</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="android-api">Android: æ“ä½œç³»ç»Ÿ API ä¸å®ç°åœ¨å†…æ ¸é‡Œï¼Ÿ</h2>
<blockquote>
<p>Linux å†…æ ¸çš„å…¶ä»–éƒ¨åˆ†ä¹Ÿå¯ä»¥ä¸å®ç°åœ¨å†…æ ¸é‡Œï¼</p>
</blockquote>
<p>ä¾‹å­ï¼šæ–‡ä»¶ç³»ç»Ÿæ˜¯ â€œå­˜å‚¨è®¾å¤‡ä¸Šçš„æ•°æ®ç»“æ„â€</p>
<ul>
<li>å¦‚æœä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰å­˜å‚¨è®¾å¤‡çš„è®¿é—®æƒé™ï¼Œé‚£å®ƒå®Œå…¨å¯ä»¥åœ¨ä¸Šé¢å®ç°æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½</li>
<li>ä¾‹å¦‚ï¼šè¯»/å†™æ–‡ä»¶<ul>
<li>å‘ â€œæ–‡ä»¶ç³»ç»Ÿâ€ æœåŠ¡è¿›ç¨‹è¿›è¡Œ RPC</li>
<li>ä¾ç„¶æ˜¯ <code>write(fd, buf, size);</code> çš„æ¥å£</li>
</ul>
</li>
<li>ç³»ç»Ÿä¸­åªéœ€æœ‰ä¸€ä¸ª â€œæ–‡ä»¶ç³»ç»Ÿâ€ æœåŠ¡è¿›ç¨‹<ul>
<li>æ‹¥æœ‰ç£ç›˜è®¾å¤‡çš„è¯»å†™æƒé™ (<code>/dev/sda</code>)ï¼Œä½†è¿è¡Œåœ¨ç”¨æˆ·æ€ (è¿›ç¨‹)</li>
<li>æ ¹æ®æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ‰§è¡Œæ•°æ®ç»“æ„çš„ç»´æŠ¤</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="linux-fuse">ä¾‹å­ï¼šæ–‡ä»¶ç³»ç»Ÿ (Linux FUSE)</h2>
<p>Userspace file system (<a href="https://www.kernel.org/doc/html/latest/filesystems/fuse.html">FUSE</a>)</p>
<ul>
<li>FUSE å†…æ ¸æ¨¡å—ä¼šåœ¨ vfs ä¸­æ³¨å†Œæ–‡ä»¶ç³»ç»Ÿ<ul>
<li>FUSE å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜</li>
<li>open ä¼šç”± vfs æ‰¾åˆ° FUSE â€œæ–‡ä»¶ç³»ç»Ÿâ€</li>
</ul>
</li>
<li>FUSE æä¾›è™šæ‹Ÿè®¾å¤‡ <code>/dev/fuse</code> (ç±»ä¼¼ binder)<ul>
<li>filesystem daemon ä» <code>/dev/fuse</code> ä¸­è·å–äº‹ä»¶ (read)</li>
<li>æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œ</li>
<li>é€šçŸ¥ <code>/dev/fuse</code> å®Œæˆ</li>
</ul>
</li>
</ul>
<p><img alt="" class="center" src="../static/wiki/os/2020/slides/img/linux-FUSE.png" width="400px"></img></p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="linux-fuse">ä¾‹å­ï¼šæ–‡ä»¶ç³»ç»Ÿ (Linux FUSE)</h2>
<p>â€œnull file systemâ€</p>
<ul>
<li>æ¥è‡ª <a href="https://github.com/libfuse/libfuse/tree/master/example">libfuse examples</a></li>
<li>ä»£ç çœ‹èµ·æ¥å’Œä½ ä»¬çš„ Lab3 å¾ˆåƒ</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">null_write</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span>
                      <span class="kt">off_t</span> <span class="n">offset</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fuse_file_info</span> <span class="o">*</span><span class="n">fi</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">ENOENT</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fuse_operations</span> <span class="n">null_oper</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">.</span><span class="n">getattr</span>  <span class="o">=</span> <span class="n">null_getattr</span><span class="p">,</span>
  <span class="p">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="n">null_truncate</span><span class="p">,</span>
  <span class="p">.</span><span class="n">open</span>     <span class="o">=</span> <span class="n">null_open</span><span class="p">,</span>
  <span class="p">.</span><span class="n">read</span>     <span class="o">=</span> <span class="n">null_read</span><span class="p">,</span>
  <span class="p">.</span><span class="n">write</span>    <span class="o">=</span> <span class="n">null_write</span><span class="p">,</span>
<span class="p">};</span>
</pre></div></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="fuse">FUSE: åˆ†æ</h2>
<p>å¹¶ä¸æ˜¯å®Œç¾çš„ (è€Œæ˜¯ä¸€ä¸ª trade-off)</p>
<p><img alt="" class="float-right" src="../static/wiki/os/2020/slides/img/win98.jpg" width="300px"></img></p>
<ul>
<li>ä¼˜ç‚¹<ul>
<li>æƒé™éš”ç¦»<ul>
<li>FUSE daemon åªèƒ½ corrupt å­˜å‚¨è®¾å¤‡</li>
<li>æ–‡ä»¶ç³»ç»Ÿå®ç°çš„é—®é¢˜ä¸å†ä¼š crash å†…æ ¸</li>
<li>æœ‰æ²¡æœ‰ç»å†è¿‡ â€œæ’ä¸Šè®¾å¤‡å°±æ­»æœºâ€ï¼Ÿ</li>
</ul>
</li>
<li>å®‰å…¨çš„ â€œuser mountâ€ æ”¯æŒ</li>
</ul>
</li>
<li>ç¼ºç‚¹<ul>
<li>æ€§èƒ½ä¸‹é™<ul>
<li>å¤šä½™çš„é¢å¤–æ•°æ®æ‹·è´ (æ•°æ® buffer) å’Œè¿›ç¨‹åŒæ­¥/ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="_1">é‡æ–°æ€è€ƒ â€œæ“ä½œç³»ç»Ÿè®¾è®¡ä¸å®ç°â€</h2>
<blockquote>
<p>â€œç³»ç»Ÿè°ƒç”¨â€ (æ“ä½œç³»ç»Ÿ API) æ˜¯ä¸ªæ¨¡ç³Šã€ä¸°å¯Œçš„æ¦‚å¿µ</p>
<ul>
<li>æˆ‘ä»¬å­¦ä¹ çš„æ˜¯åŸç† (principles)ï¼Œä¸æ˜¯çŸ¥è¯† (knowledge)<ul>
<li>(ä½† knowledge å’Œ familiarity æ˜¯é€šå¾€ principle çš„å¿…è¦é€”å¾„)</li>
</ul>
</li>
</ul>
</blockquote>
<div class="fragment">
<p>å…³äºç³»ç»Ÿè°ƒç”¨ (åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿï¼›æ“ä½œç³»ç»Ÿ API)</p>
<ul>
<li>å®é™…çš„å®ç°å¯èƒ½å¹¶ä¸åœ¨å†…æ ¸ä¸­<ul>
<li>ä¾‹å­: vdso (ä¸éœ€è¦ trap)</li>
<li>ä¾‹å­: FUSE (å®ç°ä¸åœ¨å†…æ ¸ä¸­ï¼›å†…æ ¸åªè´Ÿè´£è½¬å‘)</li>
</ul>
</li>
<li>ä¹Ÿå¯ä»¥ä¸éœ€è¦è®¾è®¡æˆ POSIX é‚£æ ·<ul>
<li>ä¾‹å­: fork å’Œ spawn ä¹‹äº‰</li>
<li>ä¾‹å­: binder + system services (Android)</li>
</ul>
</li>
</ul>
</div></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="contd">é‡æ–°æ€è€ƒ â€œæ“ä½œç³»ç»Ÿè®¾è®¡ä¸å®ç°â€ (cont'd)</h2>
<blockquote>
<p>æ“ä½œç³»ç»Ÿåº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ</p>
</blockquote>
<ul>
<li>æ“ä½œç³»ç»Ÿ (å„ä¸ªæŠ½è±¡å±‚) ä¸­æœ‰å“ªäº›å¯¹è±¡ï¼Ÿ</li>
<li>è¿™äº›å¯¹è±¡ä¸Šæœ‰ä»€ä¹ˆæ“ä½œï¼Ÿ</li>
</ul>
<blockquote>
<p>æ“ä½œç³»ç»Ÿåº”è¯¥æ€æ ·å®ç°ï¼Ÿ</p>
</blockquote>
<ul>
<li>å“ªäº›æŠ½è±¡å±‚å®ç°åœ¨ç”¨æˆ·æ€ã€å“ªäº›å®ç°åœ¨å†…æ ¸æ€ï¼Ÿ</li>
<li>å¦‚ä½•åˆ©ç”¨å¥½ CPU æä¾›çš„æœºåˆ¶ï¼Ÿ<ul>
<li>hardware virtualization (Ring -1)</li>
<li>fine-grained virtual memory</li>
<li>ç¡¬ä»¶ IPC æ”¯æŒ</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="contd">é‡æ–°æ€è€ƒ â€œæ“ä½œç³»ç»Ÿè®¾è®¡ä¸å®ç°â€ (cont'd)</h2>
<blockquote>
<p>â€œæ“ä½œç³»ç»Ÿå¦‚ä½•è®¾è®¡/å®ç°â€ï¼šå›åˆ° â€œåº”ç”¨â€ å’Œ â€œç¡¬ä»¶â€</p>
</blockquote>
<div class="fragment">
<ul>
<li>Linux (monolithic kernel): åšè¶³å¯¹ç°ä»£å¤„ç†å™¨ç‰¹æ€§çš„æ”¯æŒï¼›å¯¹ç¡¬ä»¶è¿›è¡Œè¶³å¤Ÿçš„é«˜æ€§èƒ½æŠ½è±¡ï¼Œè®©æ‰€æœ‰åº”ç”¨éƒ½æ»¡æ„</li>
</ul>
<p>æœ‰æ²¡æœ‰åˆ«çš„è®¾è®¡ï¼Ÿ</p>
<ul>
<li>åº”ç”¨ (gcc, vi, gedit, vscode, QQ, å¾®ä¿¡, æ”¯ä»˜å®, X11, httpd, mysql, Tomcat, strace, perf, ...)<ul>
<li>æ“ä½œç³»ç»Ÿè®¾è®¡å¯èƒ½éœ€è¦ â€œfavorâ€ ä¸€äº›ç‰¹å®šçš„åº”ç”¨<ul>
<li>ç§»åŠ¨æ“ä½œç³»ç»Ÿå€¾å‘äºæ”¯æŒ apps;</li>
<li>unikernel å€¾å‘äºæ”¯æŒäº‘æœåŠ¡...</li>
</ul>
</li>
</ul>
</li>
<li>ç¡¬ä»¶ (AbstractMachine: å¤šå¤„ç†å™¨ã€ä¸­æ–­ã€I/Oã€è™šå­˜â€¦â€¦)<ul>
<li>ä»¥åŠæ›´å¤šç¡¬ä»¶æä¾›çš„æœºåˆ¶</li>
</ul>
</li>
</ul>
</div></div></div>
</section>
</section>

<section>
<section>
<div class="slide-container"><div class="center middle"><h1 id="microexounikernel">Micro/Exo/Unikernel</h1></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="microkernel">Microkernel</h2>
<p>è®¾è®¡ç†å¿µ: <em>run (almost) everything as user-mode processes</em></p>
<ul>
<li>å®ç°æœ€å¤§ç¨‹åº¦çš„æƒé™éš”ç¦»<ul>
<li>æ–‡ä»¶ç³»ç»Ÿè¿›ç¨‹åªå¯¹å®ƒç®¡ç†çš„è®¾å¤‡ (ç”šè‡³æ˜¯åˆ†åŒº) æœ‰è®¿é—®æƒ</li>
<li>è®¾å¤‡é©±åŠ¨è¿›ç¨‹åªå¯¹å®ƒç®¡ç†çš„è®¾å¤‡æœ‰è®¿é—®æƒ</li>
</ul>
</li>
<li>Kernel åªæä¾›æœ€å°‘çš„ç³»ç»Ÿè°ƒç”¨<ul>
<li>(ç›¸å½“äºå¯¹ AbstractMachine ä½œå‡ºæœ€å°‘çš„å°è£…)<ul>
<li>è¿›ç¨‹æŠ½è±¡/è¿›ç¨‹é—´é€šä¿¡</li>
<li>åœ°å€ç©ºé—´ç®¡ç†</li>
<li>è®¾å¤‡è®¿é—®</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="minix-3">Minix 3</h2>
<p>å¯èƒ½æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„ microkernel?</p>
<p><img alt="" class="float-right" height="400px" src="../static/wiki/os/2020/slides/img/osdi-book.jpg"></img>
<img alt="" class="center" height="400px" src="../static/wiki/os/2020/slides/img/minix3.jpg"></img></p>
<p>æ¯ä¸€ä¸ª Intel å¤„ç†å™¨çš„ Management Engine éƒ½è¿è¡Œäº† (é­”æ”¹ç‰ˆ) Minix 3</p>
<ul>
<li>ME: å¦ä¸€å° â€œè®¡ç®—æœºâ€ï¼Œæœ‰è‡ªå·±çš„å†…å­˜ï¼Œä½†å¯ä»¥è®¿é—®è®¾å¤‡</li>
<li>è¿æ“ä½œç³»ç»Ÿéƒ½æ— æ³•è®¿é—®</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="minix-3">Minix 3: è®¾è®¡</h2>
<p>å†…æ ¸ï¼šæä¾› â€œkernel callsâ€</p>
<ul>
<li>é™¤äº†è¿›ç¨‹ä¹‹å¤–ï¼Œå‡ ä¹æ²¡æœ‰å¤æ‚çš„æŠ½è±¡ (å‡ ä¹æ˜¯ AbstractMachine çš„å°è£…)</li>
</ul>
<p>ç”¨æˆ·ç©ºé—´ servers (é«˜æƒé™ï¼Œä½†è¿è¡Œåœ¨ç”¨æˆ·æ€)</p>
<ul>
<li>é©±åŠ¨, virtual memory, virtual file system, network stack, ...</li>
</ul>
<p>ç”¨æˆ·è¿›ç¨‹ user-land (ä½æƒé™ï¼Œåªèƒ½ IPC)</p>
<ul>
<li>POSIX API å®ç°</li>
</ul>
<p><img alt="" class="center" src="../static/wiki/os/2020/slides/img/minix3-arch.jpg" width="600px"></img></p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="minix-3">Minix 3: å†…æ ¸</h2>
<p>Kernel calls</p>
<ul>
<li>æ¶ˆæ¯ä¼ é€’: send, receive, sendrec</li>
<li>è¿›ç¨‹ç®¡ç†: fork, exec, clear, exit, update, schedule, privctl, ...<ul>
<li>fork çš„è¡Œä¸ºæ¯” Linux ç®€å•çš„å¤šï¼šè¿›ç¨‹ä¸éœ€è¦ç®¡ç†æ–‡ä»¶æè¿°ç¬¦ç­‰èµ„æº</li>
</ul>
</li>
<li>ä¿¡å·ç®¡ç†: kill, getksig, endksig, sigsend, sigreturn</li>
<li>å†…å­˜ç®¡ç†: newmap, memset, vmctl, padconf</li>
<li>æ•°æ®ä¼ é€: umap, vumap, vircopy, physcopy, ...</li>
<li>è®¾å¤‡ I/O: devio, sdevio, vdevio, irqctl, ...<ul>
<li>æƒé™ç®¡ç†ï¼šåªæœ‰æœ‰æƒé™çš„è¿›ç¨‹æ‰èƒ½è®¿é—®è®¾å¤‡</li>
</ul>
</li>
<li>ç³»ç»Ÿæ§åˆ¶: abort, getinfo, ...</li>
<li>æ—¶é’Ÿç®¡ç†: setalarm, times, stime, ...</li>
</ul>
<hr></hr>
<p>It works!</p>
<ul>
<li>è¿™äº› API è¶³å¤Ÿå®ç°ä¸€ä¸ª POSIX å…¼å®¹çš„ç³»ç»Ÿ</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="1992">ä¸€åœºå…³äºæ“ä½œç³»ç»Ÿå†…æ ¸è®¾è®¡çš„è®¨è®º (1992)</h2>
<p><img alt="" class="center" src="../static/wiki/os/2020/slides/img/debate.png" width="700px"></img></p>
<blockquote>
<p>Andrew Tanenbaum: LINUX is obsolete... the debate is essentially over... Microkernels have won... (Linux) is like taking an existing, working C program and rewriting it in BASIC.</p>
<p>Linus Torvalds: I can only hope (and assume) that Amoeba doesn't suck like minix does... Linux wins heavily on points of being available now.</p>
</blockquote></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="30">30 å¹´ä¹‹åâ€¦â€¦åˆ°åº•è°èµ¢äº†ï¼Ÿ</h2>
<blockquote>
<p>è°éƒ½æ²¡æœ‰ã€‚</p>
</blockquote>
<p>Monolithic kernel æ´»ç€</p>
<ul>
<li>Linux ä¾ç„¶æ˜¯æ€§èƒ½å’Œç‰¹æ€§çš„ç‹è€…</li>
<li>ä» microkernel é‡Œå¸æ”¶äº†å¾ˆå¤šç‰¹æ€§<ul>
<li>loadable kernel module, FUSE, ...</li>
<li>åœ¨ Linux Kernel ä¸Šå åŠ æ›´å¤šçš„æŠ½è±¡å±‚ (Android)</li>
</ul>
</li>
</ul>
<p>Microkernel ä¹Ÿæ´»ç€</p>
<ul>
<li>Windows å’Œ Mach (macOS/iOS) ä¹Ÿç”Ÿå­˜å¾—å¾ˆå¥½<ul>
<li>Mach 3.0: task, thread, address space, memory object, ports, IPC, time (å’Œ Minix å¾ˆåƒï¼Œä½†å¯¹ modern systems åšäº†å¾ˆå¤šé€‚é…ï¼Œä¾‹å¦‚å¤šå¤„ç†å™¨)</li>
</ul>
</li>
<li>Google ä¹ŸåŠ å…¥äº† (Zircon/Fuschia)<ul>
<li>â€œå¤§è€Œå…¨â€ æ„å‘³ç€æµªè´¹</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="exokernel">Exokernel</h2>
<p>Monolithic/micro kernel å¹¶ä¸æ˜¯å®ç°æ“ä½œç³»ç»Ÿçš„å”¯ä¸€æ–¹æ³•</p>
<ul>
<li>å¯ä»¥æŠŠç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–åä½œä¸ºæ“ä½œç³»ç»Ÿ API<ul>
<li>æƒ³è±¡æˆæ˜¯ AbstractMachine</li>
</ul>
</li>
<li>è¿›ç¨‹å¯ä»¥ç›´æ¥è®¿é—®è™šæ‹Ÿåçš„ç¡¬ä»¶èµ„æº<ul>
<li>åº”ç”¨æ‰€éœ€çš„ API (ä¾‹å¦‚ POSIX ç³»ç»Ÿè°ƒç”¨) é€šè¿‡åº“ (Library OS) <span class="red">æŒ‰éœ€å®šåˆ¶</span><ul>
<li>D. R. Engler, et al. Exokernel: An operating system architecture for application-level resource management. In <em>Proc. of SOSP</em>, 1995.</li>
<li>ä½ ä»¬çš„æ“ä½œç³»ç»Ÿè¿è¡Œåœ¨ native ä¸Šå°±åƒæ˜¯ä¸€ä¸ª â€œLibrary OSâ€</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="" class="center" src="../static/wiki/os/2020/slides/img/exokernel.png" width="500px"></img></p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="unikernel">Unikernel</h2>
<blockquote>
<p>Exokernel çš„ä¸»è¦åŠŸèƒ½ï¼šç¡¬ä»¶çš„è™šæ‹ŸåŒ–</p>
<ul>
<li>ä»Šå¤©æˆ‘ä»¬ä¸æ˜¯æœ‰è™šæ‹Ÿæœºäº†å—ï¼Ÿ</li>
</ul>
</blockquote>
<p><img alt="" class="float-right" src="../static/wiki/os/2020/slides/img/unikernel.png" width="400px"></img></p>
<p>ç›´æ¥æ‹¿è™šæ‹Ÿæœºå½“ exokernel ä¸å°±å®Œäº†ï¼Ÿ</p>
<ul>
<li>åº”ç”¨ç¨‹åºç›´æ¥çœ‹åˆ°å®Œæ•´çš„è®¡ç®—æœºç¡¬ä»¶<ul>
<li>é“¾æ¥ä¸Š Library OS, ç›´æ¥åœ¨ Ring 0 ä¸Šæ‰§è¡Œ ğŸ˜‚</li>
<li>å¯¹æœåŠ¡å™¨ç¨‹åºæ¥è¯´ä¸æŒºå¥½å—ï¼Ÿ</li>
</ul>
</li>
<li>äº‘æœåŠ¡ï¼šçœå»äº†è™šæ‹Ÿæœºé‡Œçš„æ“ä½œç³»ç»Ÿ<ul>
<li>å° (KiB çº§)ã€å¿« (ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ)ã€å®‰å…¨ (æ€§èƒ½è¶Šå°‘è¶Šä¸å®¹æ˜“å‡ºé—®é¢˜)</li>
<li>ä½†ä¸å¥½è°ƒè¯•â€¦â€¦<ul>
<li>M. A. Madhavapeddy, et al. Unikernels: Library operating systems for the cloud. In <em>Proc. of ASPLOS</em>, 2013.</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
</section>
</section>

<section>
<section>
<div class="slide-container"><div class="center middle"><h1 id="_1">å®ç°å¯é çš„æ“ä½œç³»ç»Ÿ</h1></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="oslabs">ä½ æ„Ÿå—åˆ° OSLabs çš„æ¶æ„äº†å—ï¼Ÿ</h2>
<blockquote>
<p>ä¸ä»…æ˜¯ä½ ï¼Œä»»ä½•æ“ä½œç³»ç»Ÿå¼€å‘è€…éƒ½å€æ„Ÿå‹åŠ›ã€‚</p>
<p><img alt="" class="center" src="../static/wiki/os/2020/labs/compile-error.jpg" width="200px"></img></p>
</blockquote>
<p>å¦‚ä½•æé«˜æ“ä½œç³»ç»Ÿçš„å¯é æ€§ï¼Ÿ</p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="level-1-stress-testing">Level 1: (Stress) Testing</h2>
<p><a href="https://github.com/google/syzkaller">syzkaller</a></p>
<p><img alt="" class="float-right" src="../static/wiki/os/2020/slides/img/syzkaller.png" width="400px"></img></p>
<ul>
<li>kernel fuzzer (â€œæ¨¡ç³Šâ€ æµ‹è¯•)</li>
<li>ç”Ÿæˆç›®æ ‡ï¼šç³»ç»Ÿè°ƒç”¨çš„åºåˆ— (C ç¨‹åº)<ul>
<li>kcov æä¾›è¦†ç›–ç‡ä¿¡æ¯</li>
<li>è¦†ç›–æ–°ä»£ç çš„ç¨‹åº â†’ æ›´æœ‰ä»·å€¼<ul>
<li>è¿›è¡Œä¿®æ”¹ (mutation)ï¼Œå†æ¬¡æ‰§è¡Œ</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr></hr>
<p>syzbot: è‡ªåŠ¨æŠ¥å‘Šäº†æ•°åƒä¸ª kernel bugs</p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="level-2-software-model-checking">Level 2: (Software) Model Checking</h2>
<p>è¿˜è®°å¾— â€œç¨‹åº/è®¡ç®—æœºç³»ç»Ÿâ€ å°±æ˜¯çŠ¶æ€æœºå—ï¼Ÿ</p>
<ul>
<li>æˆ‘ä»¬ç”¨çŠ¶æ€æœº â€œè¯æ˜â€ ç®—æ³•çš„æ­£ç¡®æ€§<ul>
<li>æšä¸¾æ‰€æœ‰å¯è¾¾çš„çŠ¶æ€ï¼Œé€ä¸ªæ£€æŸ¥æ˜¯å¦å­˜åœ¨ â€œåâ€ çš„çŠ¶æ€</li>
</ul>
</li>
<li>ä¸€äº›ä¼˜åŒ–<ul>
<li>çŠ¶æ€åˆå¹¶ (ä¾‹å¦‚è·¯å¾„)ã€æœç´¢å‰ªæã€â€¦â€¦</li>
</ul>
</li>
</ul>
<hr></hr>
<p><img alt="" class="float-right" src="../static/wiki/os/2020/slides/img/tla-mem-spec.png" width="300px"></img>
<img alt="" class="center" src="../static/wiki/os/2020/slides/img/tla-mem.png" width="600px"></img></p>
<p><a href="http://lamport.azurewebsites.net/tla/tla.html">TLA+</a>: ä¸€ç§å»ºæ¨¡/æè¿°è¯­è¨€ (TLC checker)</p>
<ul>
<li>L. Lamport. <em>Specifying systems</em>. Pearson Educations, 2003.<ul>
<li>Intel, Microsoft, Amazon éƒ½åœ¨ç”¨</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="level-3-formal-verification">Level 3: Formal Verification</h2>
<p>æµ‹è¯•å’Œæšä¸¾éƒ½æ˜¯æœ‰ç©·çš„</p>
<ul>
<li>å—é™äºè¿è¡Œæ—¶é—´ï¼Œå¾ˆå¯èƒ½åšä¸å®Œæ•´</li>
<li>èƒ½ä¸èƒ½ä¸€åŠ³æ°¸é€¸åœ°<span class="red">è¯æ˜</span>ç¨‹åºæ˜¯å¯¹çš„ï¼Ÿ<ul>
<li>(ä½ åˆ«æµ‹äº†ï¼ŒåŠ³èµ„è¯æ˜äº†ç³»ç»Ÿä¸ä¼š crash!)</li>
</ul>
</li>
</ul>
<hr></hr>
<blockquote>
<p>è¿™ä¹Ÿè¡Œï¼Ÿæ²¡é”™ã€‚Computer Science ä¸ä»…æ˜¯ â€œå†™ä»£ç â€ã€‚</p>
</blockquote></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="_1">è®¡ç®—æœºè¾…åŠ©è¯æ˜</h2>
<blockquote>
<p>ç»™å®šä¸€ä¸ªè¯æ˜ï¼Œç”¨ç¨‹åºæ£€æŸ¥è¯æ˜æ˜¯å¦å­˜åœ¨ç‘•ç–µã€‚</p>
</blockquote>
<p>ä¾‹å­ï¼šåˆç­‰ä»£æ•°ï¼›å¤šé¡¹å¼çš„æ¨å¯¼</p>
<p><math class="inline-math">x + 1 = 0</math></p>
<p><math class="inline-math">\quad\Rightarrow x = -1</math> âœ”ï¸</p>
<hr></hr>
<p><math class="inline-math">x^2 + x + 1 = 0</math></p>
<p><math class="inline-math">\quad\Rightarrow (x-1)(x^2+x+1)=0</math></p>
<p><math class="inline-math">\quad\Rightarrow x^3-1 = 0</math></p>
<p><math class="inline-math">\quad\Rightarrow x = 1</math></p>
<p><math class="inline-math">\quad\Rightarrow 1^2 + 1 + 1 = 0</math></p>
<p><math class="inline-math">\quad\Rightarrow 3 = 0</math> ???</p></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="contd">è®¡ç®—æœºè¾…åŠ©è¯æ˜ (cont'd)</h2>
<blockquote>
<p><em>Four Color Theorem</em>: ä»»æ„å¹³é¢å›¾å‡å¯ç”¨ 4 ç§é¢œè‰²ç€è‰²é¡¶ç‚¹ï¼Œä½¿ç›¸é‚»çš„é¡¶ç‚¹ä¸åŒè‰²ã€‚</p>
</blockquote>
<p><span class="center"><math class="inline-math">\forall G(V, E).\ \exists C: V \mapsto [4].\ \forall (u,v) \in E. C(u) \ne C(v)</math></span></p>
<hr></hr>
<p><a href="https://people.math.gatech.edu/~thomas/FC/fourcolor.html">è¯æ˜ (outline)</a></p>
<ul>
<li>å‡è®¾ <math class="inline-math">G</math> æ˜¯æœ€å°çš„åä¾‹ (<math class="inline-math">\chi(G) > 4)</math><ul>
<li>æœ‰ä¸€äº› patterns ä¸€å®šä¸ä¼šå‡ºç°åœ¨ <math class="inline-math">G</math> ä¸­</li>
<li>ä½† <math class="inline-math">G</math> å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ª pattern<ul>
<li><math class="inline-math">G</math> (åä¾‹) ä¸å­˜åœ¨ï¼</li>
</ul>
</li>
</ul>
</li>
<li>æ•°åƒä¸ª patterns<ul>
<li>è®¡ç®—æœºå¯ä»¥å¸®åŠ©æˆ‘ä»¬éªŒè¯ï¼</li>
</ul>
</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="sel4">è¯æ˜ç¨‹åºæ˜¯æ­£ç¡®çš„: seL4</h2>
<p><img alt="" class="float-right" src="../static/wiki/os/2019/img/sel4.svg" width="220px"></img></p>
<p>ä¸ºç¨‹åºå®šä¹‰ â€œspecificationâ€, å³æˆ‘ä»¬å¸Œæœ›è¯æ˜çš„æ€§è´¨</p>
<ul>
<li>ä¸ºäº†è¯æ˜ specification å’Œå®ç°ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ C çš„æ¯ä¸ªè¯­å¥çš„è¡Œä¸ºå»ºæ¨¡</li>
</ul>
<hr></hr>
<ul>
<li>æ•´æ•°è¿ç®—æ²¡æœ‰æº¢å‡º</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">spec_violation_when</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">INT_MAX</span><span class="p">);</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>

<hr></hr>
<ul>
<li>è°ƒåº¦å™¨æ€»æ˜¯è¿”å›ä¸€ä¸ªçº¿ç¨‹ (<math class="inline-math">t\in T</math> æˆ–è€…æ˜¯ idle)</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="n">task</span> <span class="o">*</span><span class="n">schedule</span> <span class="p">{</span> <span class="p">...</span>
  <span class="n">spec_violation_when</span><span class="p">(</span><span class="o">!</span><span class="n">is_thread</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">task</span> <span class="o">==</span> <span class="n">idle</span> <span class="o">||</span> <span class="n">task</span> <span class="n">in</span> <span class="n">T</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">task</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<p>è¯æ˜ â€œhigh-levelâ€ çŠ¶æ€æœºçš„è¡Œä¸º (å»ºæ¨¡è¯­è¨€ä¸­çš„æ‰§è¡Œæµ) å’Œ â€œlow-levelâ€ çŠ¶æ€æœº (C ä»£ç ) çš„è¡Œä¸ºå§‹ç»ˆåŒæ­¥</p>
<ul>
<li>G. Klein, et al. seL4: Formal verification of an operating-system kernel. <em>Communications of the ACM</em>, 53(6), 107-115, 2010.</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="crash-consistency-fscq">è¯æ˜æ–‡ä»¶ç³»ç»Ÿçš„ Crash Consistency: FSCQ</h2>
<p>å…ˆå†™è¯æ˜ï¼Œå†ä»è¯æ˜ä¸­æå–ä»£ç </p>
<p><img alt="" class="center" src="../static/wiki/os/2020/slides/img/FSCQ.png" width="450px"></img></p>
<ul>
<li>H. Chen, et al. Using Crash Hoare Logic for certifying the FSCQ file system. In <em>Proc. of OSDI</em>, 2016.</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="_1">å‰©ä¸‹çš„éƒ¨åˆ†ï¼Ÿ</h2>
<blockquote>
<p>æ— ä¼‘æ­¢çš„æµ‹è¯• â†’ ç©·ä¸¾ â†’ è¯æ˜ â†’ ...?</p>
<ul>
<li>ä¸å¦‚æ‰¿è®¤æˆ‘ä»¬åšä¸å¯¹å°±å¥½äº†â€¦â€¦</li>
</ul>
</blockquote>
<p>è¿™æ—¶å€™ï¼Œå¾®å†…æ ¸/éš”ç¦»çš„ä¼˜åŠ¿å°±ä½“ç°äº†</p>
<ul>
<li>G. Candea, et al. Microreboot â€“ A technique for cheap recovery. In <em>Proc. of OSDI</em>, 2004.</li>
<li>J. N. Herder, et al. Minix3: A highly reliable, self-repairing operating system. In <em>ACM SIGOPS Operating Systems Review</em>, 40(3), 2006.</li>
</ul></div></div>
</section>
<section>
<div class="slide-container"><div class=""><h2 id="bug">å°ç»“ï¼šä¸ Bug æ—·æ—¥æŒä¹…çš„æˆ˜æ–—</h2>
<p>å¦‚ä½•è®©ä½ çš„æ“ä½œç³»ç»Ÿæ›´å¯é ï¼Ÿ</p>
<ul>
<li>(stress) testing: æˆ‘åœ¨è¿è¡Œçš„è¿™äº›æƒ…å†µä¸Šæ²¡æœ‰è§‚æµ‹åˆ°é—®é¢˜</li>
<li>(software) model checking: æˆ‘è·‘éäº† XX è·¯å¾„ï¼Œéƒ½æ²¡æœ‰é—®é¢˜</li>
<li>formal verification: æˆ‘è¯æ˜äº†ç¨‹åºæ‰§è¡Œå’Œé¢„æœŸçš„æ¨¡å‹ä¿æŒä¸€è‡´</li>
</ul>
<div class="fragment">
<hr></hr>
<p>å½¢å¼åŒ–éªŒè¯çš„ç³»ç»Ÿä¹Ÿè¢«æµ‹è¯•å‡º bugs</p>
<ul>
<li>CompCert (csmith; PLDI'11)</li>
<li>FSCQ (Hydra; SOSP'19)<ul>
<li>ä½† Verified systems ä¾ç„¶æ›´å¯é ï¼<ul>
<li>CompCert æ‰¾åˆ°çš„æ‰€æœ‰ bug éƒ½æ˜¯æœªè¿›è¡Œ specification çš„éƒ¨åˆ†</li>
<li>â€œéªŒè¯â€ è¿‡çš„éƒ¨åˆ†è¿˜æ²¡æœ‰å‡ºé”™</li>
</ul>
</li>
<li><span class="green">ä¸‹ä¸€ä¸ª 10 å¹´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></li>
</ul>
</li>
</ul>
</div></div></div>
</section>
</section>

<section>
<div class="slide-container"><div class=""><h2 id="takeaways-and-wrap-up">Takeaways and Wrap-up</h2>
<p>æ“ä½œç³»ç»Ÿ</p>
<ul>
<li>ç¡¬ä»¶å’Œåº”ç”¨ä¹‹é—´çš„æ¡¥æ¢</li>
</ul>
<hr></hr>
<p>æ“ä½œç³»ç»Ÿå†…æ ¸è®¾è®¡ä¸å®ç°</p>
<ul>
<li>Monolithic kernel éœ€è¦æ¨¡å—åŒ–<ul>
<li>å†…æ ¸æ˜¯é«˜åº¦ modularized system</li>
</ul>
</li>
<li>Microkernel ä¾ç„¶ç´§è€¦åˆ<ul>
<li>æ–°çš„ feature ç‰µåŠ¨å¤šä¸ªæ¨¡å—ï¼Œè¿›ç¨‹éš”ç¦» (å¼ºè¡Œè§£è€¦) åè€Œæ›´éš¾ç»´æŠ¤</li>
</ul>
</li>
<li>Library OS (Exo/unikernel) åœ¨äº‘å¹³å°ä¸Šçš„åº”ç”¨</li>
</ul>
<p>ä¸–ç•Œè¿˜ä¸å®Œç¾</p>
<ul>
<li>æ²¡æœ‰ä¸€ä¸ª single best design</li>
<li>è¿˜è¦å’Œ bugs ææ–—<ul>
<li><del>æ‰€ä»¥ç å†œè¿˜å€¼é’±</del></li>
</ul>
</li>
</ul></div></div>
</section>
  </div>
</div>

<script src="../static/js/reveal.js"></script>
<script>
  slide_num = -1;
  function update_slide_num(n) {
    if (slide_num == -1) {
      setTimeout(function() {
        if (slide_num != -1) {
          while (!Reveal.isFirstSlide()) {
            Reveal.prev();
          }
          while (Reveal.getSlidePastCount() + 1 < slide_num && !Reveal.isLastSlide()) {
            Reveal.next();
          }
          slide_num = -1;
        }
      }, 500);
      slide_num = 0;
    }
    slide_num = slide_num * 10 + n;
  }

  Reveal.initialize({
    width: 1024,
    height: 768,
    margin: 0,
    slideNumber: 'c/t',
    controls: true,
    progress: false,
    maxScale: 10,
    fragments: true,
    hash: true,
    transition: 'slide',
    transitionSpeed: 'fast',
    backgroundTransition: 'slide',
    hideCursorTime: 1000,
    navigationMode: 'default',
    keyboard: {
      13: 'next',
      48: function() { update_slide_num(0) },
      49: function() { update_slide_num(1) },
      50: function() { update_slide_num(2) },
      51: function() { update_slide_num(3) },
      52: function() { update_slide_num(4) },
      53: function() { update_slide_num(5) },
      54: function() { update_slide_num(6) },
      55: function() { update_slide_num(7) },
      56: function() { update_slide_num(8) },
      57: function() { update_slide_num(9) },
    }
  });
</script>



    <script>
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      })

      $("math").each(function() {
        var tex = $(this).text();
        var html = katex.renderToString(tex, {
          displayMode: $(this).attr('class') == 'block-math',
          throwOnError: false
        });
        $(this).replaceWith(html);
      });

      function get_token() {
        var match = document.cookie.match(new RegExp('(^| )token=([^;]+)'));
        if (match) return match[2];
        else return "";
      }

      var token = get_token();
      var hint = "token", box = $("#token-input");

      if (token == "") { box.val(hint); }
      else { box.val(token); }

      function login() {
        var token = box.val()
        document.cookie = 'token=' + token + '; expires=Fri, 31 Dec 9999 23:59:59 GMT;';
        if (token == '') {
          box.val(hint);
        }
      }
    </script>
  </body>
</html>